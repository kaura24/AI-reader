# ì œíœ´ì½”ë“œ ì¶”ì¶œê¸° (Affiliate Code Extractor)

ì´ë¯¸ì§€ì—ì„œ íŠ¹ì • ì œíœ´ì½”ë“œë¥¼ ì°¾ì•„ ê°™ì€ í–‰ì˜ ì‚¬ì—…ìë²ˆí˜¸ë¥¼ ìë™ìœ¼ë¡œ ì¶”ì¶œí•˜ê³ , ê²°ê³¼ë¥¼ CSVë¡œ ìƒì„±í•˜ì—¬ ì´ë©”ì¼ë¡œ ë°œì†¡í•˜ëŠ” ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì…ë‹ˆë‹¤.

## ì£¼ìš” ê¸°ëŠ¥

- ğŸ·ï¸ **ëŒ€ìƒ ì œíœ´ì½”ë“œ ì…ë ¥**: ì°¾ê³ ì í•˜ëŠ” ì œíœ´ì½”ë“œ ì§€ì •
- ğŸ“· **ì´ë¯¸ì§€ ì—…ë¡œë“œ**: ë“œë˜ê·¸ ì•¤ ë“œë¡­ ë˜ëŠ” í´ë¦­ìœ¼ë¡œ ì´ë¯¸ì§€ ì—…ë¡œë“œ
- ğŸ”„ **ìë™ ì••ì¶•**: Vercel 4.5MB ì œí•œì— ë§ì¶° í´ë¼ì´ì–¸íŠ¸ì—ì„œ ìë™ ë¦¬ì‚¬ì´ì§•
- ğŸ¤– **AI ì¶”ì¶œ**: OpenAI GPTê°€ ì´ë¯¸ì§€ì—ì„œ ì œíœ´ì½”ë“œë¥¼ ì°¾ì•„ ê°™ì€ í–‰ì˜ ì‚¬ì—…ìë²ˆí˜¸ ì¶”ì¶œ
- ğŸ“§ **ì´ë©”ì¼ ë°œì†¡**: ê²°ê³¼ CSVë¥¼ `kaura24@kbfg.com`ìœ¼ë¡œ ë°œì†¡
- ğŸ”Œ **ì—°ê²° í…ŒìŠ¤íŠ¸**: OpenAI API ì—°ê²° ìƒíƒœ í™•ì¸ ë²„íŠ¼

## ì‘ë™ ì›ë¦¬

1. ì‚¬ìš©ìê°€ **ëŒ€ìƒ ì œíœ´ì½”ë“œ** ì…ë ¥ (ì˜ˆ: `123456`)
2. ì œíœ´ì½”ë“œì™€ ì‚¬ì—…ìë²ˆí˜¸ê°€ í¬í•¨ëœ **ì´ë¯¸ì§€ ì—…ë¡œë“œ**
3. OpenAIê°€ ì´ë¯¸ì§€ì—ì„œ í•´ë‹¹ ì œíœ´ì½”ë“œë¥¼ ì°¾ì•„ **ê°™ì€ í–‰ì˜ ì‚¬ì—…ìë²ˆí˜¸ ì¶”ì¶œ**
4. ê²°ê³¼ë¥¼ CSVë¡œ ìƒì„±í•˜ì—¬ **ì´ë©”ì¼ ë°œì†¡**

## ê¸°ìˆ  ìŠ¤íƒ

- **Frontend**: SvelteKit 5, TypeScript
- **Backend**: SvelteKit Server Routes
- **Deployment**: Vercel
- **LLM**: OpenAI GPT-4o-mini
- **Email**: Resend

## ë¹ ë¥¸ ì‹œì‘

### 1. ì˜ì¡´ì„± ì„¤ì¹˜

```bash
npm install
```

### 2. í™˜ê²½ë³€ìˆ˜ ì„¤ì •

`.env` íŒŒì¼ì„ ìƒì„±í•˜ì„¸ìš”:

```env
OPENAI_API_KEY=sk-xxxxxxxx
OPENAI_MODEL=gpt-4o-mini
RESEND_API_KEY=re_xxxxxxxx
SENDER_EMAIL=noreply@yourdomain.com
```

### 3. ê°œë°œ ì„œë²„ ì‹¤í–‰

```bash
npm run dev
```

### 4. ë¸Œë¼ìš°ì €ì—ì„œ ì ‘ì†

http://localhost:5173

## í™˜ê²½ë³€ìˆ˜

| ë³€ìˆ˜ëª… | í•„ìˆ˜ | ê¸°ë³¸ê°’ | ì„¤ëª… |
|--------|------|--------|------|
| `OPENAI_API_KEY` | âœ… | - | OpenAI API í‚¤ |
| `OPENAI_MODEL` | âŒ | `gpt-4o-mini` | ì‚¬ìš©í•  OpenAI ëª¨ë¸ |
| `RESEND_API_KEY` | âœ… | - | Resend API í‚¤ |
| `SENDER_EMAIL` | âœ… | - | ë°œì‹  ì´ë©”ì¼ ì£¼ì†Œ |
| `AFFILIATE_CODE_REGEX` | âŒ | `^\d{6}$` | ì œíœ´ì½”ë“œ ê²€ì¦ ì •ê·œì‹ |

> ğŸ“§ ìˆ˜ì‹ ì ì´ë©”ì¼ì€ `kaura24@kbfg.com`ìœ¼ë¡œ ê³ ì •ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

## API ì—”ë“œí¬ì¸íŠ¸

### GET /api/test-connection

OpenAI API ì—°ê²° ìƒíƒœë¥¼ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤.

### POST /api/process-once

ì´ë¯¸ì§€ì—ì„œ ëŒ€ìƒ ì œíœ´ì½”ë“œì— ë§¤í•‘ëœ ì‚¬ì—…ìë²ˆí˜¸ë¥¼ ì¶”ì¶œí•©ë‹ˆë‹¤.

**Request**: `multipart/form-data`
- `image`: ì´ë¯¸ì§€ íŒŒì¼ (JPEG, PNG, WebP, GIF)
- `targetCode`: ì°¾ê³ ì í•˜ëŠ” ëŒ€ìƒ ì œíœ´ì½”ë“œ

**Response** (ì„±ê³µ):
```json
{
  "ok": true,
  "affiliate_code": "123456",
  "business_no": "123-45-67890",
  "emailed": true,
  "provider": "openai",
  "request_id": "uuid"
}
```

## í”„ë¡œì íŠ¸ êµ¬ì¡°

```
src/
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ client/
â”‚   â”‚   â””â”€â”€ imageShrink.ts     # í´ë¼ì´ì–¸íŠ¸ ì´ë¯¸ì§€ ì••ì¶•
â”‚   â”œâ”€â”€ email/
â”‚   â”‚   â””â”€â”€ resend.ts          # Resend ì´ë©”ì¼ ë°œì†¡
â”‚   â”œâ”€â”€ extract/
â”‚   â”‚   â””â”€â”€ affiliateCode.ts   # ì‚¬ì—…ìë²ˆí˜¸ ì¶”ì¶œ ë¡œì§
â”‚   â”œâ”€â”€ llm/
â”‚   â”‚   â””â”€â”€ openai.ts          # OpenAI API
â”‚   â”œâ”€â”€ output/
â”‚   â”‚   â””â”€â”€ csv.ts             # CSV ìƒì„±
â”‚   â””â”€â”€ util/
â”‚       â””â”€â”€ env.ts             # í™˜ê²½ë³€ìˆ˜ ê²€ì¦
â””â”€â”€ routes/
    â”œâ”€â”€ +page.svelte           # ë©”ì¸ UI
    â””â”€â”€ api/
        â”œâ”€â”€ test-connection/
        â”‚   â””â”€â”€ +server.ts     # ì—°ê²° í…ŒìŠ¤íŠ¸ API
        â””â”€â”€ process-once/
            â””â”€â”€ +server.ts     # ì¶”ì¶œ API
```

## ë°°í¬

### Vercel ë°°í¬

```bash
# Vercel CLI ì„¤ì¹˜
npm install -g vercel

# ë°°í¬
vercel --prod
```

ìì„¸í•œ ë‚´ìš©ì€ [RUNBOOK.md](./RUNBOOK.md)ë¥¼ ì°¸ì¡°í•˜ì„¸ìš”.

## ë¼ì´ì„ ìŠ¤

MIT
